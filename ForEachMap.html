<!DOCTYPE html>
<html>
<head>
<script src="ForEachMap.js"></script>
<style>

body {
  font-family: monospace;
  white-space: pre;
}

</style>
</head>
<body>
<script>

function print(s) {
  document.body.appendChild(document.createTextNode(s + '\n'));
}

function assertEquals(a, b) {
  if (a === b)
    print('PASS: ' + a);
  else
    print('FAIL: ' + a + ' !== ' + b);
}

var m = new ForEachMap;
m.set('a', 'A');
assertEquals(true, m.has('a'));
assertEquals(false, m.has(new String('a')));

m.set('b', 'B');
m.delete('a');
assertEquals(false, m.has('a'));
m.set('a', 'AA');

function keys(map) {
  var rv = [];
  map.forEach(function(_, k) {
    rv.push(k);
  });
  return rv;
}

function values(map) {
  var rv = [];
  map.forEach(function(v) {
    rv.push(v);
  });
  return rv;
}

m.forEach(function(v, k) {
  assertEquals(true, m.has(k));
  assertEquals(v, m.get(k));
  assertEquals(m, this);
  if (k === 'b') {
    m.delete('b');
    m.set('c', 'C');
  } else {
    console.log(k, v);
  }
});

assertEquals('ac', keys(m).join(''));
assertEquals('AAC', values(m).join(''));

for (var i = 0; i < 500; i++) {
  m.set(i, i);
}

for (var i = 0; i < 500; i++) {
  if (i % 100)
    m.delete(i);
}

assertEquals('ac0100200300400', keys(m).join(''));
assertEquals('AAC0100200300400', values(m).join(''));

var obj = {};
m.forEach(function(v, k, self) {
  assertEquals(m, self);
  assertEquals(this, obj);
}, obj);

</script>
</body>
</html>